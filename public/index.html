<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>메이플스토리 ocid 조회</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:#fff;
  padding:40px;
  max-width:600px;
  margin:auto;
}

h1 { margin-bottom:20px; }

.card {
  background:#020617;
  padding:20px;
  border-radius:10px;
  margin-top:20px;
}

label {
  margin-right:15px;
  cursor:pointer;
}

input[type="text"] {
  padding:10px;
  width:100%;
  margin-top:10px;
}

button {
  margin-top:12px;
  padding:10px;
  width:100%;
  cursor:pointer;
}

pre {
  white-space:pre-wrap;
  word-break:break-all;
}

.copy-btn {
  background:#1e293b;
  margin-top:5px;
}

.error {
  color:#f87171;
}
.small {
  font-size:12px;
  opacity:0.8;
}
</style>
</head>

<body>

<h1>메이플스토리 ocid 조회</h1>

<div class="card">
  <div>
    <label>
      <input type="radio" name="mode" value="ocid" checked />
      캐릭터 이름 → ocid
    </label>
    <label>
      <input type="radio" name="mode" value="character" />
      ocid → 캐릭터 정보
    </label>
  </div>

  <input id="input" placeholder="캐릭터 이름 입력" />
  <button id="searchBtn">조회</button>

  <div id="resultArea" style="display:none;">
    <pre id="result"></pre>
    <button class="copy-btn" onclick="copyResult()">결과 복사</button>
  </div>
</div>

<p class="small" style="margin-top:40px;">
  Data based on NEXON Open API<br/>
  ChatGPT로 제작됨.
</p>

<script>
const input = document.getElementById("input");
const resultBox = document.getElementById("result");
const resultArea = document.getElementById("resultArea");
const button = document.getElementById("searchBtn");

let currentResult = "";

document.querySelectorAll("input[name='mode']").forEach(radio => {
  radio.addEventListener("change", () => {
    resultArea.style.display = "none";
    input.value = "";
    input.placeholder =
      radio.value === "ocid"
        ? "캐릭터 이름 입력"
        : "ocid 입력";
  });
});

function errorMessage(status) {
  switch (status) {
    case 400: return "입력값이 올바르지 않습니다.";
    case 403: return "API 키 권한이 없습니다.";
    case 429: return "요청이 너무 많습니다. 잠시 후 다시 시도하세요.";
    case 500: return "서버 오류가 발생했습니다.";
    default: return "알 수 없는 오류";
  }
}

button.addEventListener("click", async () => {
  const mode = document.querySelector("input[name='mode']:checked").value;
  const value = input.value.trim();

  if (!value) {
    resultBox.innerHTML = `<span class="error">값을 입력해주세요.</span>`;
    resultArea.style.display = "block";
    return;
  }

  button.disabled = true;
  button.textContent = "조회 중...";
  resultArea.style.display = "block";
  resultBox.textContent = "조회 중...";

  try {
    let res, data;

    if (mode === "ocid") {
      res = await fetch(`/api/ocid?character_name=${encodeURIComponent(value)}`);
      data = await res.json();

      if (!res.ok) throw res.status;

      currentResult = `ocid:\n${data.ocid}`;
    } else {
      res = await fetch(`/api/character?ocid=${value}`);
      data = await res.json();

      if (!res.ok) throw res.status;

      currentResult =
`닉네임: ${data.character_name}
월드: ${data.world_name}
직업: ${data.character_class}
레벨: ${data.character_level}
길드: ${data.character_guild_name || "없음"}`;
    }

    resultBox.textContent = currentResult;

  } catch (status) {
    resultBox.innerHTML =
      `<span class="error">${errorMessage(status)}</span>`;
  } finally {
    button.disabled = false;
    button.textContent = "조회";
  }
});

function copyResult() {
  if (!currentResult) return;
  navigator.clipboard.writeText(currentResult);
  alert("복사되었습니다!");
}
</script>

</body>
</html>
